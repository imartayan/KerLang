<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="bundle.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.2/split.min.js"
    integrity="sha512-to2k78YjoNUq8+hnJS8AwFg/nrLRFLdYYalb18SlcsFRXavCOTfBF3lNyplKkLJeB8YjKVTb1FPHGSy9sXfSdg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"
    integrity="sha512-GZ1RIgZaSc8rnco/8CXfRdCpDxRCphenIiZ2ztLy3XQfCbQUSCuk8IudvNHxkRA3oUg6q0qejgN/qqyG1duv5Q=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <style>
    html {
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      padding: 0;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100%;
    }

    p {
      transition: height linear;
      transition-duration: 0.3s;
      overflow: hidden;
    }

    span:hover {
      text-decoration: underline;
      cursor: pointer;
    }

    #code,
    #specs,
    #result {
      width: 50%;
      height: 20%;
      margin: 10px;
      border: 2px solid #aaa;
      display: block;
    }

    #result {
      overflow: scroll;
    }

    #code {
      display: flex;
    }

    #code #format {
      height: 100%;
      padding: 10px;
      margin: 0;
      overflow: scroll;
    }

    #code #editor {
      height: 100%;
      padding: 0;
      margin: 0;
      border: none;
      resize: none;
    }

    #buttons {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      width: 30%;
    }

    .gutter {
      background-color: #aaa;
      background-repeat: no-repeat;
      background-position: 50%;
    }
  </style>
</head>

<body>
  <div id="code">
    <div id="editor"></div>
    <!-- <textarea name="editor" id="editor" cols="30" rows="10"></textarea> -->
    <div id="format"></div>
  </div>
  <div id="buttons">
    <button id="compile">compile</button>
    <button id="genC">generate C</button>
    <button id="genPY">generate Py</button>
    <button id="genML">generate ML</button>
  </div>
  <div id="specs">
  </div>
  <div id="result">
    <pre id="output"></pre>
  </div>
  <script>
    let compile = document.getElementById('compile')
    let genC = document.getElementById('genC')
    let genPY = document.getElementById('genPY')
    let genML = document.getElementById('genML')
    let editor = document.getElementById('editor')
    let format = document.getElementById('format')
    let output = document.getElementById('output')
    let ace_editor = ace.edit('editor')
    ace_editor.setTheme('ace/theme/github')
    Split(['#editor', '#format'])
    compile.addEventListener('click', () => {
      format.innerHTML = Kerlang.compile(ace_editor.getValue())
      renderCode()
    })
    genC.addEventListener('click', () => {
      let g = Kerlang.generateC(ace_editor.getValue())
      format.innerHTML = g.specs
      output.innerText = g.result
      renderCode()
    })
    genPY.addEventListener('click', () => {
      let g = Kerlang.generatePY(ace_editor.getValue())
      format.innerHTML = g.specs
      output.innerText = g.result
      renderCode()
    })
    genML.addEventListener('click', () => {
      let g = Kerlang.generateML(ace_editor.getValue())
      format.innerHTML = g.specs
      output.innerText = g.result
      renderCode()
    })

    function renderCode() {
      let codes = format.getElementsByTagName('code')
      for (element of codes) {
        console.log(element)
        let spec_id = 'spec' + parseInt(element.id.substring(4))
        let spec = document.getElementById(spec_id)
        let height = spec.offsetHeight
        spec.style.height = height
        spec.is_shown = true
        element.addEventListener('click', () => {
          if (spec.is_shown) {
            spec.is_shown = false
            spec.style.height = 0
          } else {
            spec.is_shown = true
            spec.style.height = height
          }
        })
      }
    }
  </script>
</body>

</html>